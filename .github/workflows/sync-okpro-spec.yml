name: N9G9 - Sync OKPro (No Checkout)
on:
  workflow_dispatch: # 手动触发

jobs:
  sync_release_directly:
    runs-on: ubuntu-latest
    permissions:
      contents: write # 必须赋予写权限
    steps:
      - name: Direct Download and Upload
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          # 自动获取当前仓库名 (sowahsun/N9G9)
          TARGET_REPO: ${{ github.repository }} 
          SOURCE_URL: "https://raw.githubusercontent.com/sowahsun/apk/main/okprotv3.9.3.apk"
          RELEASE_TAG: "OKPRO-3.9.3"
          FILE_NAME: "okprotv_3.9.3_v7a.apk"
        run: |
          echo "🚀 模式：跳过代码拉取，直接操作 API"
          
          # 1. 检查版本是否存在 (注意增加了 -R 参数指定仓库)
          if gh release view "$RELEASE_TAG" -R "$TARGET_REPO" >/dev/null 2>&1; then
            echo "✅ 版本 $RELEASE_TAG 已存在，任务结束。"
            exit 0
          fi

          # 2. 下载文件 (直接下载到虚拟机临时目录)
          echo "⬇️ 正在从源下载文件..."
          curl -L -o "$FILE_NAME" "$SOURCE_URL"

          # 3. 创建 Release 并上传
          # 关键点：使用 -R $TARGET_REPO 告诉指令操作哪个仓库，无需 Checkout
          echo "⬆️ 正在发布到 $TARGET_REPO ..."
          gh release create "$RELEASE_TAG" "$FILE_NAME" \
            -R "$TARGET_REPO" \
            --title "重要版本备份: OKPro 3.9.3" \
            --notes "此版本提取自 sowahsun/apk 并按要求进行了重命名 (无需 Checkout 模式)。"

          echo "🎉 成功！"
